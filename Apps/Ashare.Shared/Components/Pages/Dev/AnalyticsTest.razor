@page "/dev/analytics-test"
@using Ashare.Shared.Services.Analytics
@inject AnalyticsService Analytics

<div class="analytics-test-page" style="padding: 20px; direction: rtl;">
    <h1 style="margin-bottom: 20px;">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</h1>

    <div class="test-section" style="background: var(--ashare-gray-100); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
        <h3>ğŸ“Š Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
            <button class="test-btn" @onclick="TestScreenView">ğŸ“± Ù…Ø´Ø§Ù‡Ø¯Ø© ØµÙØ­Ø©</button>
            <button class="test-btn" @onclick="TestSearch">ğŸ” Ø¨Ø­Ø«</button>
            <button class="test-btn" @onclick="TestCustomEvent">âš¡ Ø­Ø¯Ø« Ù…Ø®ØµØµ</button>
        </div>
    </div>

    <div class="test-section" style="background: var(--ashare-gray-100); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
        <h3>ğŸ‘¤ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
            <button class="test-btn" @onclick="TestRegistration">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
            <button class="test-btn" @onclick="TestLogin">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
            <button class="test-btn" @onclick="TestSetUserId">ğŸ†” ØªØ¹ÙŠÙŠÙ† Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
        </div>
    </div>

    <div class="test-section" style="background: var(--ashare-gray-100); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
        <h3>ğŸ  Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
            <button class="test-btn" @onclick="TestContentView">ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¹Ù‚Ø§Ø±</button>
            <button class="test-btn" @onclick="TestAddToWishlist">â¤ï¸ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©</button>
            <button class="test-btn" @onclick="TestShare">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ©</button>
        </div>
    </div>

    <div class="test-section" style="background: var(--ashare-gray-100); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
        <h3>ğŸ’° Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø´Ø±Ø§Ø¡</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
            <button class="test-btn" style="background: var(--ashare-secondary);" @onclick="TestPurchase">ğŸ’³ Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡</button>
        </div>
    </div>

    <div class="log-section" style="background: #1a1a2e; color: #00ff00; padding: 16px; border-radius: 12px; font-family: monospace; max-height: 300px; overflow-y: auto;">
        <h3 style="color: #fff; margin-bottom: 10px;">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h3>
        @foreach (var log in _logs.AsEnumerable().Reverse())
        {
            <div style="margin: 4px 0; padding: 4px; border-bottom: 1px solid #333;">@log</div>
        }
        @if (!_logs.Any())
        {
            <div style="color: #888;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø²Ø± Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ø¯Ø«...</div>
        }
    </div>
</div>

<style>
    .test-btn {
        background: var(--ashare-primary);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: transform 0.1s;
    }
    .test-btn:hover {
        transform: scale(1.05);
    }
    .test-btn:active {
        transform: scale(0.95);
    }
</style>

@code {
    private List<string> _logs = new();

    private void Log(string message)
    {
        _logs.Add($"[{DateTime.Now:HH:mm:ss}] {message}");
        StateHasChanged();
    }

    private async Task TestScreenView()
    {
        await Analytics.TrackScreenViewAsync("Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", new() { ["source"] = "test" });
        Log("ğŸ“± ØªÙ… Ø¥Ø±Ø³Ø§Ù„: Ù…Ø´Ø§Ù‡Ø¯Ø© ØµÙØ­Ø© 'Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©'");
    }

    private async Task TestSearch()
    {
        await Analytics.TrackSearchAsync("Ø´Ù‚Ø© ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶", new() { ["results_count"] = 15 });
        Log("ğŸ” ØªÙ… Ø¥Ø±Ø³Ø§Ù„: Ø¨Ø­Ø« 'Ø´Ù‚Ø© ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶'");
    }

    private async Task TestCustomEvent()
    {
        await Analytics.TrackEventAsync("button_click", new() { ["button_name"] = "test_button" });
        Log("âš¡ ØªÙ… Ø¥Ø±Ø³Ø§Ù„: Ø­Ø¯Ø« Ù…Ø®ØµØµ 'button_click'");
    }

    private async Task TestRegistration()
    {
        await Analytics.TrackRegistrationAsync("phone", new() { ["country"] = "SA" });
        Log("ğŸ“ ØªÙ… Ø¥Ø±Ø³Ø§Ù„: ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„Ù‡Ø§ØªÙ");
    }

    private async Task TestLogin()
    {
        await Analytics.TrackLoginAsync("phone");
        Log("ğŸ”‘ ØªÙ… Ø¥Ø±Ø³Ø§Ù„: ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„");
    }

    private async Task TestSetUserId()
    {
        await Analytics.SetUserIdAsync("user_12345");
        Log("ğŸ†” ØªÙ… Ø¥Ø±Ø³Ø§Ù„: ØªØ¹ÙŠÙŠÙ† Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… 'user_12345'");
    }

    private async Task TestContentView()
    {
        await Analytics.TrackContentViewAsync(new ContentViewEvent
        {
            ContentId = "listing_789",
            ContentName = "Ø´Ù‚Ø© ÙØ§Ø®Ø±Ø© ÙÙŠ Ø­ÙŠ Ø§Ù„Ù†Ø±Ø¬Ø³",
            ContentType = "listing",
            Category = "Ø´Ù‚Ù‚",
            Value = 2500,
            Currency = "SAR"
        });
        Log("ğŸ‘ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„: Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¹Ù‚Ø§Ø± 'Ø´Ù‚Ø© ÙØ§Ø®Ø±Ø© ÙÙŠ Ø­ÙŠ Ø§Ù„Ù†Ø±Ø¬Ø³'");
    }

    private async Task TestAddToWishlist()
    {
        await Analytics.TrackAddToWishlistAsync(new ContentViewEvent
        {
            ContentId = "listing_789",
            ContentName = "Ø´Ù‚Ø© ÙØ§Ø®Ø±Ø© ÙÙŠ Ø­ÙŠ Ø§Ù„Ù†Ø±Ø¬Ø³",
            ContentType = "listing",
            Value = 2500
        });
        Log("â¤ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„: Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©");
    }

    private async Task TestShare()
    {
        await Analytics.TrackShareAsync("listing", "listing_789", "whatsapp");
        Log("ğŸ“¤ ØªÙ… Ø¥Ø±Ø³Ø§Ù„: Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨");
    }

    private async Task TestPurchase()
    {
        await Analytics.TrackPurchaseAsync(new PurchaseEvent
        {
            TransactionId = $"TXN_{DateTime.Now:yyyyMMddHHmmss}",
            Value = 299,
            Currency = "SAR",
            ContentType = "subscription",
            PaymentMethod = "card",
            Items = new()
            {
                new PurchaseItem
                {
                    ItemId = "plan_premium",
                    ItemName = "Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©",
                    Category = "Ø§Ø´ØªØ±Ø§ÙƒØ§Øª",
                    Price = 299,
                    Quantity = 1
                }
            }
        });
        Log("ğŸ’³ ØªÙ… Ø¥Ø±Ø³Ø§Ù„: Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡ 'Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©' - 299 Ø±ÙŠØ§Ù„");
    }
}
