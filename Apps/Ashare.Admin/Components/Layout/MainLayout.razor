@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@inject Ashare.Admin.Services.AuthService AuthService

<div class="ac-admin-layout @(SidebarCollapsed ? "sidebar-collapsed" : "")">
    <aside class="admin-sidebar">
        <AcSidebar Title="Ø¹Ø´ÙŠØ±" 
                   MenuItems="@MenuItems" 
                   @bind-IsCollapsed="@SidebarCollapsed">
            <FooterContent>
                <div class="user-info">
                    <span class="user-avatar">Ù…</span>
                    @if (!SidebarCollapsed)
                    {
                        <span class="user-name">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                        <button class="logout-btn" @onclick="Logout">Ø®Ø±ÙˆØ¬</button>
                    }
                </div>
            </FooterContent>
        </AcSidebar>
    </aside>
    
    <div class="admin-main">
        <header class="admin-header">
            <div class="header-left">
                <h1 class="page-title">@GetPageTitle()</h1>
            </div>
            <div class="header-right">
                <SfButton CssClass="e-outline" IconCss="e-icons e-bell">
                    Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                </SfButton>
            </div>
        </header>
        
        <main class="admin-content">
            @Body
        </main>
        
        <footer class="admin-footer">
            <span>Â© 2025 Ø¹Ø´ÙŠØ± - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</span>
        </footer>
    </div>
</div>

@code {
    private bool SidebarCollapsed { get; set; } = false;

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
        NavigationManager.NavigateTo("/login", true);
    }

    private List<AcSidebar.SidebarMenuItem> MenuItems => new()
    {
        new() { Title = "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…", Url = "/", Icon = "ğŸ“Š", IsActive = IsCurrentPage("/") },
        new() { Title = "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†", Url = "/users", Icon = "ğŸ‘¥", IsActive = IsCurrentPage("/users") },
        new() { Title = "Ø§Ù„Ø¹Ø±ÙˆØ¶", Url = "/listings", Icon = "ğŸ¢", IsActive = IsCurrentPage("/listings"), Badge = 23 },
        new() { Title = "Ø§Ù„Ø·Ù„Ø¨Ø§Øª", Url = "/orders", Icon = "ğŸ“¦", IsActive = IsCurrentPage("/orders") },
        new() { Title = "Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±", Url = "/reports", Icon = "ğŸ“ˆ", IsActive = IsCurrentPage("/reports") },
        new() { Title = "Ø§Ù„ØªØ³ÙˆÙŠÙ‚", Url = "/marketing", Icon = "ğŸ“£", IsActive = IsCurrentPage("/marketing") },
        new() { Title = "Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª", Url = "/versions", Icon = "ğŸ”„", IsActive = IsCurrentPage("/versions") },
        new() { Title = "Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†", Url = "/admin-users", Icon = "ğŸ›¡ï¸", IsActive = IsCurrentPage("/admin-users") },
        new() { Title = "Ø§Ù„Ø£Ø¯ÙˆØ§Ø±", Url = "/roles", Icon = "ğŸ”", IsActive = IsCurrentPage("/roles") },
        new() { Title = "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", Url = "/settings", Icon = "âš™ï¸", IsActive = IsCurrentPage("/settings") },
    };

    private bool IsCurrentPage(string url)
    {
        var currentPath = new Uri(NavigationManager.Uri).AbsolutePath;
        return currentPath == url || (url != "/" && currentPath.StartsWith(url));
    }

    private string GetPageTitle()
    {
        var currentPath = new Uri(NavigationManager.Uri).AbsolutePath;
        return currentPath switch
        {
            "/" => "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
            "/users" => "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†",
            "/listings" => "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø±ÙˆØ¶",
            "/orders" => "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª",
            "/reports" => "Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±",
            "/settings" => "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
            "/marketing" => "ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚",
            "/versions" => "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª",
            "/admin-users" => "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†",
            "/roles" => "Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª",
            _ => "Ø¹Ø´ÙŠØ±"
        };
    }
}
