@page "/profile"
@using ACommerce.Client.Profiles
@using ACommerce.Templates.Customer.Pages
@inject ILocalizationService L
@inject IAppNavigationService Navigation
@inject TokenManager TokenManager
@inject ProfilesClient ProfilesClient
@inject IAppVersionService VersionService

@if (!_isLoggedIn)
{
    <div class="ac-page">
        <AcEmptyState Icon="bi-person-circle"
                      Title="Welcome to Hamtramck Hardware"
                      Description="Sign in to manage your account, track orders, and more."
                      ActionText="Sign In"
                      ActionIcon="bi-box-arrow-in-right"
                      OnAction="GoToLogin" />

        <div style="text-align: center; margin-top: 16px;">
            <AcButton Text="Create Account"
                      Icon="bi-person-plus"
                      Variant="ButtonVariant.Secondary"
                      OnClick="GoToRegister" />
        </div>
    </div>
}
else
{
    <ProfilePage User="@_userInfo"
                 OrdersCount="@_ordersCount"
                 WishlistCount="@_wishlistCount"
                 ReviewsCount="@_reviewsCount"
                 AddressesCount="@_addressesCount"
                 PendingOrdersCount="@_pendingOrdersCount"
                 AppVersion="@_appVersion"
                 OnAvatarClick="HandleAvatarClick"
                 OnOrdersClick="HandleOrdersClick"
                 OnWishlistClick="HandleWishlistClick"
                 OnReviewsClick="HandleReviewsClick"
                 OnLogout="HandleLogout" />

    <!-- Pro Membership Banner (Custom HamtramckHardware element) -->
    <div class="hh-pro-banner ac-card" style="margin: 16px;">
        <div class="hh-pro-content">
            <div class="hh-pro-icon">
                <i class="bi bi-gem"></i>
            </div>
            <div class="hh-pro-text">
                <h4>Become a Pro Member</h4>
                <p>Get 10% off all purchases + free shipping</p>
            </div>
            <AcButton Text="Join Pro"
                      Variant="ButtonVariant.Warning"
                      OnClick="HandleJoinPro" />
        </div>
    </div>
}

<style>
    .hh-pro-banner {
        background: linear-gradient(135deg, var(--ac-primary) 0%, var(--ac-primary-dark) 100%);
        color: white;
        padding: 20px;
    }

    .hh-pro-content {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .hh-pro-icon {
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        flex-shrink: 0;
    }

    .hh-pro-text {
        flex: 1;
    }

    .hh-pro-text h4 {
        margin: 0 0 4px;
        color: white;
        font-size: 1rem;
    }

    .hh-pro-text p {
        margin: 0;
        opacity: 0.9;
        font-size: 0.875rem;
    }

    @@media (max-width: 480px) {
        .hh-pro-content {
            flex-wrap: wrap;
        }

        .hh-pro-text {
            flex: 1 1 100%;
            order: -1;
            margin-bottom: 12px;
        }

        .hh-pro-icon {
            order: -2;
        }
    }
</style>

@code {
    private bool _isLoggedIn = false;
    private UserProfileInfo? _userInfo;
    private string _appVersion = "1.0.0";

    private int _ordersCount = 12;
    private int _wishlistCount = 5;
    private int _reviewsCount = 3;
    private int _addressesCount = 2;
    private int _pendingOrdersCount = 1;

    protected override async Task OnInitializedAsync()
    {
        var token = await TokenManager.GetTokenAsync();
        _isLoggedIn = !string.IsNullOrEmpty(token);

        if (_isLoggedIn)
        {
            await LoadProfile();
        }

        _appVersion = VersionService.Version;
    }

    private async Task LoadProfile()
    {
        try
        {
            await Task.Delay(100);

            _userInfo = new UserProfileInfo
            {
                Name = "Michael Johnson",
                Email = "michael.johnson@email.com",
                AvatarUrl = null
            };
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading profile: {ex.Message}");
        }
    }

    private async Task HandleAvatarClick()
    {
        Navigation.NavigateTo("/profile/edit");
    }

    private async Task HandleOrdersClick()
    {
        Navigation.NavigateTo("/orders");
    }

    private async Task HandleWishlistClick()
    {
        Navigation.NavigateTo("/favorites");
    }

    private async Task HandleReviewsClick()
    {
        Navigation.NavigateTo("/reviews");
    }

    private async Task HandleLogout()
    {
        TokenManager.ClearToken();
        _isLoggedIn = false;
        _userInfo = null;
        Navigation.NavigateTo("/");
    }

    private void GoToLogin()
    {
        Navigation.NavigateTo("/login");
    }

    private void GoToRegister()
    {
        Navigation.NavigateTo("/register");
    }

    private void HandleJoinPro()
    {
        Navigation.NavigateTo("/pro-membership");
    }
}
