@page "/"
@inject ILocalizationService L
@inject IAppNavigationService Navigation
@inject CategoriesClient CategoriesClient
@inject ProductsClient ProductsClient

<div class="hh-home">
    <!-- Search Bar -->
    <div class="hh-search-bar" @onclick='() => Navigation.NavigateTo("/search")'>
        <i class="bi bi-search hh-search-icon"></i>
        <input type="text" class="hh-search-input" placeholder="Search tools, plumbing, electrical..." readonly />
    </div>

    <!-- Categories Scroll -->
    <div class="hh-category-scroll" style="padding: 0 16px;">
        @foreach (var category in _categories)
        {
            <div class="hh-category-pill @(_selectedCategory == category.Code ? "active" : "")"
                 @onclick="() => SelectCategory(category.Code)">
                <i class="@category.Icon hh-category-icon"></i>
                <span class="hh-category-name">@category.Name</span>
            </div>
        }
    </div>

    <!-- Featured Products Section -->
    <div class="hh-section-header">
        <span class="hh-section-title">Featured Products</span>
        <a href="/products" class="hh-section-link">@L["SeeAll"] →</a>
    </div>

    @if (_isLoading)
    {
        <div style="display: flex; justify-content: center; padding: 40px;">
            <div class="hh-spinner"></div>
        </div>
    }
    else
    {
        <div class="hh-products-grid">
            @foreach (var product in _featuredProducts)
            {
                <div class="hh-product-card" @onclick="() => ViewProduct(product.Id)">
                    <img src="@(product.ImageUrl ?? "/images/placeholder-product.png")"
                         alt="@product.Name"
                         class="hh-product-image" />
                    <div class="hh-product-info">
                        <div class="hh-product-name">@product.Name</div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="hh-product-price">$@product.Price.ToString("0.00")</span>
                            @if (product.OriginalPrice.HasValue && product.OriginalPrice > product.Price)
                            {
                                <span class="hh-product-original-price">$@product.OriginalPrice.Value.ToString("0.00")</span>
                            }
                        </div>
                        <span class="hh-stock-badge @(product.InStock ? "in-stock" : "out-of-stock")">
                            @(product.InStock ? L["InStock"] : L["OutOfStock"])
                        </span>
                    </div>
                </div>
            }
        </div>
    }

    <!-- Best Sellers Section -->
    <div class="hh-section-header">
        <span class="hh-section-title">Best Sellers</span>
        <a href="/products?sort=bestselling" class="hh-section-link">@L["SeeAll"] →</a>
    </div>

    <div class="hh-products-grid">
        @foreach (var product in _bestSellers)
        {
            <div class="hh-product-card" @onclick="() => ViewProduct(product.Id)">
                <img src="@(product.ImageUrl ?? "/images/placeholder-product.png")"
                     alt="@product.Name"
                     class="hh-product-image" />
                <div class="hh-product-info">
                    <div class="hh-product-name">@product.Name</div>
                    <span class="hh-product-price">$@product.Price.ToString("0.00")</span>
                </div>
            </div>
        }
    </div>

    <!-- Store Info Banner -->
    <div class="hh-card" style="margin: 16px; text-align: center;">
        <h3 style="margin-bottom: 8px;">
            <i class="bi bi-shop"></i> Visit Our Store
        </h3>
        <p style="color: var(--hh-text-secondary); margin-bottom: 8px;">
            @L["StoreAddress"]
        </p>
        <p style="color: var(--hh-text-secondary); margin-bottom: 16px;">
            <i class="bi bi-clock"></i> @L["StoreHours"]
        </p>
        <a href="tel:+13133652400" class="hh-btn hh-btn-primary">
            <i class="bi bi-telephone"></i> Call Us
        </a>
    </div>
</div>

@code {
    private bool _isLoading = true;
    private string? _selectedCategory = null;
    private List<CategoryItem> _categories = new();
    private List<ProductItem> _featuredProducts = new();
    private List<ProductItem> _bestSellers = new();

    protected override async Task OnInitializedAsync()
    {
        // Initialize with default categories
        _categories = GetDefaultCategories();

        // Load products
        await LoadProducts();
    }

    private List<CategoryItem> GetDefaultCategories()
    {
        return new List<CategoryItem>
        {
            new("plumbing", "Plumbing", "bi bi-droplet"),
            new("electrical", "Electrical", "bi bi-lightning"),
            new("tools", "Tools", "bi bi-tools"),
            new("lawn", "Lawn & Garden", "bi bi-flower1"),
            new("paint", "Paint", "bi bi-palette"),
            new("lumber", "Lumber", "bi bi-box"),
            new("flooring", "Flooring", "bi bi-grid-3x3"),
            new("hardware", "Hardware", "bi bi-nut"),
        };
    }

    private async Task LoadProducts()
    {
        try
        {
            _isLoading = true;

            // In production, this would call the actual API
            // For now, we'll use mock data
            await Task.Delay(500); // Simulate API call

            _featuredProducts = GetMockProducts();
            _bestSellers = GetMockProducts().Take(4).ToList();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading products: {ex.Message}");
        }
        finally
        {
            _isLoading = false;
        }
    }

    private List<ProductItem> GetMockProducts()
    {
        return new List<ProductItem>
        {
            new(Guid.NewGuid(), "DeWalt 20V MAX Cordless Drill", 149.99m, null, true, "/images/products/drill.jpg"),
            new(Guid.NewGuid(), "Copper Pipe Fittings Set", 24.99m, 29.99m, true, "/images/products/fittings.jpg"),
            new(Guid.NewGuid(), "LED Shop Light 4ft", 39.99m, null, true, "/images/products/light.jpg"),
            new(Guid.NewGuid(), "Milwaukee Hammer Drill", 299.99m, 349.99m, true, "/images/products/hammer-drill.jpg"),
            new(Guid.NewGuid(), "PVC Pipe 10ft Bundle", 18.99m, null, true, "/images/products/pvc.jpg"),
            new(Guid.NewGuid(), "Electrical Wire 100ft", 45.99m, null, true, "/images/products/wire.jpg"),
            new(Guid.NewGuid(), "Socket Wrench Set 40pc", 79.99m, 99.99m, true, "/images/products/socket-set.jpg"),
            new(Guid.NewGuid(), "Garden Hose 50ft", 29.99m, null, false, "/images/products/hose.jpg"),
        };
    }

    private void SelectCategory(string code)
    {
        _selectedCategory = _selectedCategory == code ? null : code;
        Navigation.NavigateTo($"/products?category={code}");
    }

    private void ViewProduct(Guid id)
    {
        Navigation.NavigateTo($"/product/{id}");
    }

    // Inner classes
    private record CategoryItem(string Code, string Name, string Icon);
    private record ProductItem(Guid Id, string Name, decimal Price, decimal? OriginalPrice, bool InStock, string? ImageUrl);
}
