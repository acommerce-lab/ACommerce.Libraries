@page "/"
@using ACommerce.Templates.Customer.Pages
@inject ILocalizationService L
@inject IAppNavigationService Navigation
@inject CategoriesClient CategoriesClient
@inject ProductsClient ProductsClient

<div class="ac-page hh-home">
    <!-- Hero Banner -->
    <section class="hh-hero">
        <div class="hh-hero-content">
            <h1>Hamtramck Hardware</h1>
            <p>Your local hardware experts since 1952</p>
        </div>
    </section>

    <!-- Search Box -->
    <section class="ac-hero-section">
        <AcSearchBox Placeholder="Search tools, plumbing, electrical..."
                     Value="@_searchQuery"
                     ValueChanged="s => _searchQuery = s"
                     OnSearch="HandleSearch"
                     ShowVoiceSearch="false" />
    </section>

    <!-- Feature Cards -->
    <div class="hh-feature-cards">
        <div class="hh-feature-card">
            <i class="bi bi-truck"></i>
            <span>Free Shipping $50+</span>
        </div>
        <div class="hh-feature-card">
            <i class="bi bi-shield-check"></i>
            <span>2-Year Warranty</span>
        </div>
        <div class="hh-feature-card">
            <i class="bi bi-headset"></i>
            <span>Expert Help</span>
        </div>
        <div class="hh-feature-card">
            <i class="bi bi-clock-history"></i>
            <span>Same Day Pickup</span>
        </div>
    </div>

    <!-- Categories Section -->
    <section class="ac-section">
        <div class="ac-section-header">
            <h2 class="ac-section-title">Shop by Category</h2>
            <a href="/products" class="ac-section-link">See All</a>
        </div>
        <div class="ac-categories-scroll">
            @foreach (var category in _categories)
            {
                <div class="ac-category-item" @onclick="() => SelectCategory(category.Id)">
                    <div class="ac-category-icon">
                        <i class="@category.Icon"></i>
                    </div>
                    <span class="ac-category-name">@category.Name</span>
                </div>
            }
        </div>
    </section>

    <!-- Featured Products -->
    <section class="ac-section">
        <div class="ac-section-header">
            <h2 class="ac-section-title">Featured Products</h2>
            <a href="/products?featured=true" class="ac-section-link">See All</a>
        </div>

        @if (_isLoading)
        {
            <div class="ac-loading-overlay">
                <AcSpinner Size="SpinnerSize.Large" Text="Loading products..." />
            </div>
        }
        else
        {
            <div class="ac-products-scroll">
                @foreach (var product in _featuredProducts)
                {
                    <AcProductCard Id="@product.Id"
                                   Name="@product.Name"
                                   ImageUrl="@product.Image"
                                   Price="@product.Price"
                                   OldPrice="@product.OldPrice"
                                   Rating="@product.Rating"
                                   ReviewCount="@product.ReviewCount"
                                   IsFeatured="true"
                                   Currency="$"
                                   DynamicAttributes="@product.Attributes"
                                   OnClick="HandleProductClick"
                                   OnAddToCart="HandleAddToCart" />
                }
            </div>
        }
    </section>

    <!-- Deals of the Week -->
    <section class="ac-section hh-deals-section">
        <div class="ac-section-header">
            <h2 class="ac-section-title"><i class="bi bi-fire" style="color: var(--ac-accent);"></i> Deals of the Week</h2>
            <a href="/products?sort=deals" class="ac-section-link">See All</a>
        </div>
        <div class="ac-products-scroll">
            @foreach (var product in _dealsProducts)
            {
                <AcProductCard Id="@product.Id"
                               Name="@product.Name"
                               ImageUrl="@product.Image"
                               Price="@product.Price"
                               OldPrice="@product.OldPrice"
                               Rating="@product.Rating"
                               DiscountPercent="@(product.OldPrice > 0 ? (int)Math.Round((product.OldPrice - product.Price) / product.OldPrice * 100) : 0)"
                               Currency="$"
                               OnClick="HandleProductClick"
                               OnAddToCart="HandleAddToCart" />
            }
        </div>
    </section>

    <!-- Best Sellers -->
    <section class="ac-section">
        <div class="ac-section-header">
            <h2 class="ac-section-title">Best Sellers</h2>
            <a href="/products?bestseller=true" class="ac-section-link">See All</a>
        </div>
        <div class="ac-products-grid">
            @foreach (var product in _bestSellers.Take(6))
            {
                <AcProductCard Id="@product.Id"
                               Name="@product.Name"
                               ImageUrl="@product.Image"
                               Price="@product.Price"
                               OldPrice="@product.OldPrice"
                               Rating="@product.Rating"
                               ReviewCount="@product.ReviewCount"
                               Currency="$"
                               DynamicAttributes="@product.Attributes"
                               OnClick="HandleProductClick"
                               OnAddToCart="HandleAddToCart" />
            }
        </div>
    </section>

    <!-- Store Info Banner -->
    <section class="hh-store-info ac-card">
        <i class="bi bi-shop hh-store-icon"></i>
        <h3>Visit Our Store</h3>
        <p class="hh-store-name">Hamtramck Hardware & Building Supply</p>
        <p class="hh-store-address">9033 Joseph Campau Ave, Hamtramck, MI 48212</p>
        <p class="hh-store-hours"><i class="bi bi-clock"></i> Mon-Sat 7AM-7PM | Sun 9AM-5PM</p>
        <div class="hh-store-actions">
            <AcButton Text="(313) 365-2400"
                      Icon="bi-telephone"
                      Variant="ButtonVariant.Primary"
                      OnClick="HandleCallStore" />
            <AcButton Text="Get Directions"
                      Icon="bi-geo-alt"
                      Variant="ButtonVariant.Secondary"
                      OnClick="HandleGetDirections" />
        </div>
    </section>

    <!-- Newsletter Signup -->
    <section class="hh-newsletter">
        <i class="bi bi-envelope-paper"></i>
        <h3>Get Exclusive Deals</h3>
        <p>Sign up for our newsletter and get 10% off your first order!</p>
        <div class="hh-newsletter-form">
            <AcInput Placeholder="Enter your email"
                     @bind-Value="_newsletterEmail"
                     Type="email" />
            <AcButton Text="Subscribe"
                      Variant="ButtonVariant.Warning"
                      OnClick="HandleSubscribe" />
        </div>
    </section>
</div>

<style>
    .hh-home {
        padding-bottom: 80px;
    }

    /* Hero Banner */
    .hh-hero {
        background: linear-gradient(135deg, var(--ac-primary) 0%, var(--ac-primary-dark) 100%);
        color: white;
        padding: 32px 16px;
        text-align: center;
    }

    .hh-hero h1 {
        font-size: 1.75rem;
        font-weight: 800;
        margin-bottom: 8px;
        color: white;
    }

    .hh-hero p {
        opacity: 0.9;
        margin: 0;
    }

    /* Feature Cards */
    .hh-feature-cards {
        display: flex;
        gap: 8px;
        padding: 16px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    .hh-feature-cards::-webkit-scrollbar { display: none; }

    .hh-feature-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        padding: 12px 16px;
        background: var(--ac-surface);
        border-radius: var(--ac-radius-lg);
        box-shadow: var(--ac-shadow-sm);
        font-size: 0.75rem;
        white-space: nowrap;
        flex-shrink: 0;
        color: var(--ac-text-secondary);
    }

    .hh-feature-card i {
        font-size: 1.25rem;
        color: var(--ac-primary);
    }

    /* Deals Section */
    .hh-deals-section {
        background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
        padding: 16px;
        margin: 16px;
        border-radius: var(--ac-radius-xl);
    }

    /* Store Info */
    .hh-store-info {
        margin: 16px;
        padding: 24px;
        text-align: center;
    }

    .hh-store-icon {
        font-size: 2.5rem;
        color: var(--ac-primary);
        margin-bottom: 12px;
    }

    .hh-store-info h3 {
        margin-bottom: 12px;
    }

    .hh-store-name {
        font-weight: 600;
        color: var(--ac-text);
        margin-bottom: 4px;
    }

    .hh-store-address, .hh-store-hours {
        color: var(--ac-text-secondary);
        font-size: 0.875rem;
        margin-bottom: 8px;
    }

    .hh-store-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 16px;
        flex-wrap: wrap;
    }

    /* Newsletter */
    .hh-newsletter {
        margin: 16px;
        padding: 24px;
        background: linear-gradient(135deg, var(--ac-primary) 0%, var(--ac-primary-dark) 100%);
        border-radius: var(--ac-radius-xl);
        color: white;
        text-align: center;
    }

    .hh-newsletter i {
        font-size: 2rem;
        margin-bottom: 8px;
    }

    .hh-newsletter h3 {
        color: white;
        margin-bottom: 8px;
    }

    .hh-newsletter p {
        opacity: 0.9;
        margin-bottom: 16px;
    }

    .hh-newsletter-form {
        display: flex;
        gap: 8px;
        max-width: 400px;
        margin: 0 auto;
    }

    .hh-newsletter-form .ac-input {
        flex: 1;
    }
</style>

@code {
    private bool _isLoading = true;
    private string? _searchQuery;
    private string? _newsletterEmail;

    private List<HomeCategoryItem> _categories = new();
    private List<HomeProductItem> _featuredProducts = new();
    private List<HomeProductItem> _bestSellers = new();
    private List<HomeProductItem> _dealsProducts = new();

    protected override async Task OnInitializedAsync()
    {
        _categories = GetDefaultCategories();
        await LoadProducts();
    }

    private List<HomeCategoryItem> GetDefaultCategories()
    {
        return new List<HomeCategoryItem>
        {
            new() { Id = Guid.NewGuid(), Name = "Plumbing", Icon = "bi bi-droplet" },
            new() { Id = Guid.NewGuid(), Name = "Electrical", Icon = "bi bi-lightning-charge" },
            new() { Id = Guid.NewGuid(), Name = "Power Tools", Icon = "bi bi-tools" },
            new() { Id = Guid.NewGuid(), Name = "Hand Tools", Icon = "bi bi-wrench" },
            new() { Id = Guid.NewGuid(), Name = "Lawn & Garden", Icon = "bi bi-flower1" },
            new() { Id = Guid.NewGuid(), Name = "Paint", Icon = "bi bi-palette" },
            new() { Id = Guid.NewGuid(), Name = "Lumber", Icon = "bi bi-box" },
            new() { Id = Guid.NewGuid(), Name = "Hardware", Icon = "bi bi-nut" },
        };
    }

    private async Task LoadProducts()
    {
        try
        {
            _isLoading = true;
            await Task.Delay(300);

            _featuredProducts = GetFeaturedProducts();
            _bestSellers = GetBestSellers();
            _dealsProducts = GetDealsProducts();
        }
        finally
        {
            _isLoading = false;
        }
    }

    private List<HomeProductItem> GetFeaturedProducts()
    {
        return new List<HomeProductItem>
        {
            new() { Id = Guid.NewGuid(), Name = "DeWalt 20V MAX XR Brushless Drill", Image = "/images/products/drill.jpg", Price = 149.99m, OldPrice = 179.99m, Rating = 4.8, ReviewCount = 1247, Attributes = new() { { "Brand", "DeWalt" } } },
            new() { Id = Guid.NewGuid(), Name = "Milwaukee M18 FUEL Hammer Drill", Image = "/images/products/hammer-drill.jpg", Price = 299.99m, OldPrice = 349.99m, Rating = 4.9, ReviewCount = 892, Attributes = new() { { "Brand", "Milwaukee" } } },
            new() { Id = Guid.NewGuid(), Name = "Makita 18V LXT Impact Driver", Image = "/images/products/impact.jpg", Price = 179.99m, Rating = 4.7, ReviewCount = 654, Attributes = new() { { "Brand", "Makita" } } },
            new() { Id = Guid.NewGuid(), Name = "Bosch Flexiclick 5-In-1 Drill", Image = "/images/products/flexiclick.jpg", Price = 199.99m, OldPrice = 229.99m, Rating = 4.6, ReviewCount = 423, Attributes = new() { { "Brand", "Bosch" } } },
            new() { Id = Guid.NewGuid(), Name = "Stanley Copper Pipe Cutter", Image = "/images/products/pipe-cutter.jpg", Price = 34.99m, Rating = 4.5, ReviewCount = 312, Attributes = new() { { "Brand", "Stanley" } } },
            new() { Id = Guid.NewGuid(), Name = "Southwire Romex 12/2 Wire 250ft", Image = "/images/products/romex.jpg", Price = 89.99m, OldPrice = 99.99m, Rating = 4.8, ReviewCount = 567, Attributes = new() { { "Brand", "Southwire" } } },
        };
    }

    private List<HomeProductItem> GetBestSellers()
    {
        return new List<HomeProductItem>
        {
            new() { Id = Guid.NewGuid(), Name = "3M Scotch Blue Painter's Tape", Image = "/images/products/tape.jpg", Price = 8.99m, Rating = 4.9, ReviewCount = 2341, Attributes = new() { { "Brand", "3M" } } },
            new() { Id = Guid.NewGuid(), Name = "Gorilla Construction Adhesive", Image = "/images/products/adhesive.jpg", Price = 7.49m, Rating = 4.7, ReviewCount = 1823, Attributes = new() { { "Brand", "Gorilla" } } },
            new() { Id = Guid.NewGuid(), Name = "WD-40 Multi-Use Product 12oz", Image = "/images/products/wd40.jpg", Price = 6.99m, Rating = 4.8, ReviewCount = 3156, Attributes = new() { { "Brand", "WD-40" } } },
            new() { Id = Guid.NewGuid(), Name = "SharkBite Push-to-Connect Coupling", Image = "/images/products/sharkbite.jpg", Price = 12.99m, Rating = 4.6, ReviewCount = 892, Attributes = new() { { "Brand", "SharkBite" } } },
            new() { Id = Guid.NewGuid(), Name = "Leviton Outlet 10-Pack", Image = "/images/products/outlets.jpg", Price = 24.99m, Rating = 4.7, ReviewCount = 1567, Attributes = new() { { "Brand", "Leviton" } } },
            new() { Id = Guid.NewGuid(), Name = "Klein Tools 11-in-1 Screwdriver", Image = "/images/products/klein-screwdriver.jpg", Price = 24.99m, Rating = 4.9, ReviewCount = 2089, Attributes = new() { { "Brand", "Klein" } } },
        };
    }

    private List<HomeProductItem> GetDealsProducts()
    {
        return new List<HomeProductItem>
        {
            new() { Id = Guid.NewGuid(), Name = "Ryobi ONE+ 18V 6-Tool Combo Kit", Image = "/images/products/ryobi-kit.jpg", Price = 299.99m, OldPrice = 449.99m, Rating = 4.7, ReviewCount = 1456 },
            new() { Id = Guid.NewGuid(), Name = "CRAFTSMAN 320-Piece Tool Set", Image = "/images/products/craftsman-set.jpg", Price = 199.99m, OldPrice = 299.99m, Rating = 4.8, ReviewCount = 987 },
            new() { Id = Guid.NewGuid(), Name = "Husky 52\" Tool Chest & Cabinet", Image = "/images/products/tool-chest.jpg", Price = 599.99m, OldPrice = 899.99m, Rating = 4.6, ReviewCount = 423 },
            new() { Id = Guid.NewGuid(), Name = "RIDGID 12-Gallon Shop Vacuum", Image = "/images/products/shop-vac.jpg", Price = 79.99m, OldPrice = 119.99m, Rating = 4.5, ReviewCount = 678 },
        };
    }

    private void SelectCategory(Guid categoryId)
    {
        Navigation.NavigateTo($"/products?category={categoryId}");
    }

    private async Task HandleSearch(string query)
    {
        Navigation.NavigateTo($"/search?q={Uri.EscapeDataString(query)}");
    }

    private async Task HandleProductClick(Guid productId)
    {
        Navigation.NavigateTo($"/product/{productId}");
    }

    private async Task HandleAddToCart(Guid productId)
    {
        // TODO: Add to cart implementation
        Console.WriteLine($"Added product {productId} to cart");
    }

    private void HandleCallStore()
    {
        Navigation.NavigateTo("tel:+13133652400");
    }

    private void HandleGetDirections()
    {
        Navigation.NavigateTo("https://maps.google.com/?q=9033+Joseph+Campau+Ave+Hamtramck+MI");
    }

    private void HandleSubscribe()
    {
        if (!string.IsNullOrWhiteSpace(_newsletterEmail))
        {
            // TODO: Newsletter subscription
            Console.WriteLine($"Subscribed: {_newsletterEmail}");
        }
    }
}
