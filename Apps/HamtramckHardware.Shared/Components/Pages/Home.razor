@page "/"
@using ACommerce.Templates.Customer.Pages
@using HamtramckHardware.Shared.Services
@inject HamtramckDataService DataService
@inject IAppNavigationService Navigation

<div class="ac-page hh-home">
    <!-- Hero Banner -->
    <section class="hh-hero">
        <div class="hh-hero-content">
            <h1>Hamtramck Hardware</h1>
            <p>Your local hardware experts since 1952</p>
        </div>
    </section>

    <!-- Search Box -->
    <section class="ac-hero-section">
        <AcSearchBox Placeholder="Search tools, plumbing, electrical..."
                     OnSearch="HandleSearch"
                     ShowVoiceSearch="false" />
    </section>

    <!-- Feature Cards -->
    <div class="hh-feature-cards">
        <div class="hh-feature-card"><i class="bi bi-truck"></i><span>Free Shipping $50+</span></div>
        <div class="hh-feature-card"><i class="bi bi-shield-check"></i><span>2-Year Warranty</span></div>
        <div class="hh-feature-card"><i class="bi bi-headset"></i><span>Expert Help</span></div>
        <div class="hh-feature-card"><i class="bi bi-clock-history"></i><span>Same Day Pickup</span></div>
    </div>

    <!-- Categories Section -->
    <section class="ac-section">
        <div class="ac-section-header">
            <h2 class="ac-section-title">Shop by Category</h2>
            <a href="/products" class="ac-section-link">See All</a>
        </div>
        <div class="ac-categories-scroll">
            @foreach (var category in _categories)
            {
                <div class="ac-category-item" @onclick="() => SelectCategory(category.Id)">
                    <div class="ac-category-icon"><i class="@category.Icon"></i></div>
                    <span class="ac-category-name">@category.Name</span>
                </div>
            }
        </div>
    </section>

    <!-- Featured Products -->
    <section class="ac-section">
        <div class="ac-section-header">
            <h2 class="ac-section-title">Featured Products</h2>
            <a href="/products?featured=true" class="ac-section-link">See All</a>
        </div>
        <div class="ac-products-scroll">
            @foreach (var product in _featuredProducts)
            {
                <AcProductCard Id="@product.Id" Name="@product.Name" ImageUrl="@product.Image"
                               Price="@product.Price" OldPrice="@product.OldPrice"
                               Rating="@product.Rating" ReviewCount="@product.ReviewCount"
                               IsFeatured="true" Currency="$" CurrencyBeforePrice="true"
                               FeaturedLabel="Featured" NewLabel="New"
                               InStockLabel="In Stock ({0})" OutOfStockLabel="Out of Stock"
                               AddToCartLabel="Add to Cart" AddToWishlistLabel="Add to Wishlist"
                               OnClick="HandleProductClick" OnAddToCart="HandleAddToCart" />
            }
        </div>
    </section>

    <!-- Deals of the Week -->
    <section class="ac-section hh-deals-section">
        <div class="ac-section-header">
            <h2 class="ac-section-title"><i class="bi bi-fire" style="color: var(--ac-accent);"></i> Deals of the Week</h2>
            <a href="/products?sort=deals" class="ac-section-link">See All</a>
        </div>
        <div class="ac-products-scroll">
            @foreach (var product in _dealsProducts)
            {
                <AcProductCard Id="@product.Id" Name="@product.Name" ImageUrl="@product.Image"
                               Price="@product.Price" OldPrice="@product.OldPrice"
                               Rating="@product.Rating"
                               DiscountPercent="@(product.OldPrice > 0 ? (int)Math.Round((product.OldPrice - product.Price) / product.OldPrice * 100) : 0)"
                               Currency="$" CurrencyBeforePrice="true"
                               FeaturedLabel="Featured" NewLabel="New"
                               InStockLabel="In Stock ({0})" OutOfStockLabel="Out of Stock"
                               AddToCartLabel="Add to Cart" AddToWishlistLabel="Add to Wishlist"
                               OnClick="HandleProductClick" OnAddToCart="HandleAddToCart" />
            }
        </div>
    </section>

    <!-- Best Sellers -->
    <section class="ac-section">
        <div class="ac-section-header">
            <h2 class="ac-section-title">Best Sellers</h2>
            <a href="/products?bestseller=true" class="ac-section-link">See All</a>
        </div>
        <div class="ac-products-grid">
            @foreach (var product in _bestSellers.Take(6))
            {
                <AcProductCard Id="@product.Id" Name="@product.Name" ImageUrl="@product.Image"
                               Price="@product.Price" OldPrice="@product.OldPrice"
                               Rating="@product.Rating" ReviewCount="@product.ReviewCount"
                               Currency="$" CurrencyBeforePrice="true"
                               FeaturedLabel="Featured" NewLabel="New"
                               InStockLabel="In Stock ({0})" OutOfStockLabel="Out of Stock"
                               AddToCartLabel="Add to Cart" AddToWishlistLabel="Add to Wishlist"
                               OnClick="HandleProductClick" OnAddToCart="HandleAddToCart" />
            }
        </div>
    </section>

    <!-- Store Info Banner -->
    <section class="hh-store-info ac-card">
        <i class="bi bi-shop hh-store-icon"></i>
        <h3>Visit Our Store</h3>
        <p class="hh-store-name">Hamtramck Hardware & Building Supply</p>
        <p class="hh-store-address">9033 Joseph Campau Ave, Hamtramck, MI 48212</p>
        <p class="hh-store-hours"><i class="bi bi-clock"></i> Mon-Sat 7AM-7PM | Sun 9AM-5PM</p>
        <div class="hh-store-actions">
            <AcButton Text="(313) 365-2400" Icon="bi-telephone" Variant="ButtonVariant.Primary" OnClick="CallStore" />
            <AcButton Text="Get Directions" Icon="bi-geo-alt" Variant="ButtonVariant.Secondary" OnClick="GetDirections" />
        </div>
    </section>
</div>

<style>
    .hh-home { padding-bottom: 80px; }
    .hh-hero { background: linear-gradient(135deg, var(--ac-primary) 0%, var(--ac-primary-dark) 100%); color: white; padding: 32px 16px; text-align: center; }
    .hh-hero h1 { font-size: 1.75rem; font-weight: 800; margin-bottom: 8px; color: white; }
    .hh-hero p { opacity: 0.9; margin: 0; }
    .hh-feature-cards { display: flex; gap: 8px; padding: 16px; overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .hh-feature-cards::-webkit-scrollbar { display: none; }
    .hh-feature-card { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 12px 16px; background: var(--ac-surface); border-radius: var(--ac-radius-lg); box-shadow: var(--ac-shadow-sm); font-size: 0.75rem; white-space: nowrap; flex-shrink: 0; color: var(--ac-text-secondary); }
    .hh-feature-card i { font-size: 1.25rem; color: var(--ac-primary); }
    .hh-deals-section { background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); padding: 16px; margin: 16px; border-radius: var(--ac-radius-xl); }
    .hh-store-info { margin: 16px; padding: 24px; text-align: center; }
    .hh-store-icon { font-size: 2.5rem; color: var(--ac-primary); margin-bottom: 12px; }
    .hh-store-info h3 { margin-bottom: 12px; }
    .hh-store-name { font-weight: 600; color: var(--ac-text); margin-bottom: 4px; }
    .hh-store-address, .hh-store-hours { color: var(--ac-text-secondary); font-size: 0.875rem; margin-bottom: 8px; }
    .hh-store-actions { display: flex; gap: 12px; justify-content: center; margin-top: 16px; flex-wrap: wrap; }
</style>

@code {
    private List<HomeCategoryItem> _categories = new();
    private List<HomeProductItem> _featuredProducts = new();
    private List<HomeProductItem> _bestSellers = new();
    private List<HomeProductItem> _dealsProducts = new();

    protected override async Task OnInitializedAsync()
    {
        _categories = await DataService.GetCategoriesAsync();
        _featuredProducts = await DataService.GetFeaturedProductsAsync();
        _bestSellers = await DataService.GetBestSellersAsync();
        _dealsProducts = await DataService.GetDealsProductsAsync();
    }

    private void SelectCategory(Guid categoryId) => Navigation.NavigateTo($"/products?category={categoryId}");
    private async Task HandleSearch(string query) => Navigation.NavigateTo($"/search?q={Uri.EscapeDataString(query)}");
    private async Task HandleProductClick(Guid productId) => Navigation.NavigateTo($"/product/{productId}");
    private async Task HandleAddToCart(Guid productId) => Console.WriteLine($"Added product {productId} to cart");
    private void CallStore() => Navigation.NavigateTo("tel:+13133652400");
    private void GetDirections() => Navigation.NavigateTo("https://maps.google.com/?q=9033+Joseph+Campau+Ave+Hamtramck+MI");
}
