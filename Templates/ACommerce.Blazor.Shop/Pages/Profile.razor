@page "/profile"
@inject ProfilesClient ProfilesClient
@inject ContactPointsClient ContactPointsClient
@inject AuthClient AuthClient
@inject NavigationManager Navigation
@inject NotificationService Notification

<PageTitle>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - Profile</PageTitle>

<div class="profile-page">
	<SfTab>
		<TabItems>
			<!-- Profile Info Tab -->
			<TabItem>
				<ChildContent>
					<TabHeader Text="Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©" />
				</ChildContent>
				<ContentTemplate>
					<SfCard>
						<CardContent>
							@if (isLoadingProfile)
							{
								<div class="loading-container">
									<SfSpinner />
								</div>
							}
							else if (profile != null)
							{
								<div class="profile-section">
									<div class="profile-avatar-section">
										<div class="profile-avatar-large">
											@GetAvatarInitials(profile.FullName)
										</div>
										<SfButton OnClick="ChangeAvatar">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</SfButton>
									</div>

									<EditForm Model="@profile" OnValidSubmit="SaveProfile">
										<DataAnnotationsValidator />
										<ValidationSummary />

										<div class="form-grid">
											<SfTextBox @bind-Value="profile.FullName"
													   FloatLabelType="FloatLabelType.Auto">
												<label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
											</SfTextBox>

											<SfTextBox @bind-Value="profile.Username"
													   FloatLabelType="FloatLabelType.Auto">
												<label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
											</SfTextBox>

											<SfDatePicker @bind-Value="profile.DateOfBirth"
														  FloatLabelType="FloatLabelType.Auto">
												<label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
											</SfDatePicker>

											<SfDropDownList TValue="string"
															TItem="GenderOption"
															@bind-Value="profile.Gender"
															DataSource="@genderOptions"
															FloatLabelType="FloatLabelType.Auto">
												<DropDownListFieldSettings Text="Label" Value="Value" />
												<label>Ø§Ù„Ø¬Ù†Ø³</label>
											</SfDropDownList>

											<SfTextBox @bind-Value="profile.Bio"
													   Multiline="true"
													   FloatLabelType="FloatLabelType.Auto">
												<label>Ù†Ø¨Ø°Ø© Ø¹Ù†ÙŠ</label>
											</SfTextBox>
										</div>

										<div class="form-actions">
											<SfButton Type="Submit" IsPrimary="true" Disabled="@isSaving">
												@if (isSaving) { <SfSpinner /> } else { <span>Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</span> }
											</SfButton>
										</div>
									</EditForm>
								</div>
							}
						</CardContent>
					</SfCard>
				</ContentTemplate>
			</TabItem>

			<!-- Contact Points Tab -->
			<TabItem>
				<ChildContent>
					<TabHeader Text="Ù†Ù‚Ø§Ø· Ø§Ù„Ø§ØªØµØ§Ù„" />
				</ChildContent>
				<ContentTemplate>
					<SfCard>
						<CardHeader>
							<div class="section-header">
								<h3>Ù†Ù‚Ø§Ø· Ø§Ù„Ø§ØªØµØ§Ù„</h3>
								<SfButton IsPrimary="true" OnClick="ShowAddContactPointDialog">
									+ Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
								</SfButton>
							</div>
						</CardHeader>
						<CardContent>
							@if (isLoadingContactPoints)
							{
								<div class="loading-container">
									<SfSpinner />
								</div>
							}
							else if (contactPoints == null || !contactPoints.Any())
							{
								<div class="empty-state">
									<div class="empty-icon">ğŸ“‡</div>
									<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø· Ø§ØªØµØ§Ù„</h3>
									<p>Ø£Ø¶Ù Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ù„Ù„ØªÙˆØ§ØµÙ„</p>
								</div>
							}
							else
							{
								<div class="contact-points-list">
									@foreach (var cp in contactPoints)
									{
										<div class="contact-point-item">
											<div class="cp-icon">@GetContactPointIcon(cp.Type)</div>
											<div class="cp-info">
												<div class="cp-header">
													<strong>@cp.Value</strong>
													@if (cp.IsPrimary)
													{
														<span class="primary-badge">Ø£Ø³Ø§Ø³ÙŠ</span>
													}
													@if (cp.IsVerified)
													{
														<span class="verified-badge">âœ“ Ù…ÙˆØ«Ù‚</span>
													}
												</div>
												<div class="cp-meta">
													<span class="cp-type">@cp.Type</span>
													<span class="cp-label">@cp.Label</span>
												</div>
											</div>
											<div class="cp-actions">
												@if (!cp.IsVerified)
												{
													<SfButton CssClass="verify-btn" OnClick="() => VerifyContactPoint(cp.Id)">
														ØªØ­Ù‚Ù‚
													</SfButton>
												}
												@if (!cp.IsPrimary)
												{
													<SfButton OnClick="() => SetPrimary(cp.Id)">
														ØªØ¹ÙŠÙŠÙ† ÙƒØ£Ø³Ø§Ø³ÙŠ
													</SfButton>
												}
												<SfButton IconCss="e-icons e-edit" OnClick="() => EditContactPoint(cp)" />
												<SfButton IconCss="e-icons e-delete" OnClick="() => DeleteContactPoint(cp.Id)" />
											</div>
										</div>
									}
								</div>
							}
						</CardContent>
					</SfCard>
				</ContentTemplate>
			</TabItem>

			<!-- Security Tab -->
			<TabItem>
				<ChildContent>
					<TabHeader Text="Ø§Ù„Ø£Ù…Ø§Ù†" />
				</ChildContent>
				<ContentTemplate>
					<SfCard>
						<CardContent>
							<div class="security-section">
								<div class="security-item">
									<div class="security-info">
										<h4>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h4>
										<p>ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ</p>
									</div>
									<SfButton OnClick="ShowChangePasswordDialog">ØªØºÙŠÙŠØ±</SfButton>
								</div>

								<div class="security-item">
									<div class="security-info">
										<h4>Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©</h4>
										<p>Ø·Ø¨Ù‚Ø© Ø£Ù…Ø§Ù† Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø­Ø³Ø§Ø¨Ùƒ</p>
									</div>
									<SfCheckBox @bind-Checked="twoFactorEnabled" Label="@(twoFactorEnabled ? "Ù…ÙØ¹Ù‘Ù„" : "Ù…Ø¹Ø·Ù‘Ù„")" TChecked="bool">
										<CheckBoxEvents TChecked="bool" Change="ToggleTwoFactor" />
									</SfCheckBox>
								</div>

								<div class="security-item">
									<div class="security-info">
										<h4>Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h4>
										<p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØªØµÙ„Ø© Ø¨Ø­Ø³Ø§Ø¨Ùƒ</p>
									</div>
									<SfButton OnClick="@(() => Navigation.NavigateTo("/profile/sessions"))">
										Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
									</SfButton>
								</div>
							</div>
						</CardContent>
					</SfCard>
				</ContentTemplate>
			</TabItem>

			<!-- Preferences Tab -->
			<TabItem>
				<ChildContent>
					<TabHeader Text="Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª" />
				</ChildContent>
				<ContentTemplate>
					<SfCard>
						<CardContent>
							<div class="preferences-section">
								<div class="preference-group">
									<h4>Ø§Ù„Ù„ØºØ©</h4>
									<SfDropDownList TValue="string"
													TItem="LanguageOption"
													@bind-Value="selectedLanguage"
													DataSource="@languageOptions">
										<DropDownListFieldSettings Text="Label" Value="Value" />
										<DropDownListEvents TValue="string" TItem="LanguageOption" ValueChange="OnLanguageChanged" />
									</SfDropDownList>
								</div>

								<div class="preference-group">
									<h4>Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©</h4>
									<SfDropDownList TValue="string"
													TItem="CurrencyOption"
													@bind-Value="selectedCurrency"
													DataSource="@currencyOptions">
										<DropDownListFieldSettings Text="Label" Value="Value" />
									</SfDropDownList>
								</div>

								<div class="preference-group">
									<h4>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h4>
									<SfCheckBox @bind-Checked="emailNotifications" Label="Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" TChecked="bool" />
									<SfCheckBox @bind-Checked="smsNotifications" Label="Ø¥Ø´Ø¹Ø§Ø±Ø§Øª SMS" TChecked="bool" />
									<SfCheckBox @bind-Checked="pushNotifications" Label="Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ©" TChecked="bool" />
								</div>

								<SfButton IsPrimary="true" OnClick="SavePreferences">
									Ø­ÙØ¸ Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª
								</SfButton>
							</div>
						</CardContent>
					</SfCard>
				</ContentTemplate>
			</TabItem>
		</TabItems>
	</SfTab>
</div>

<!-- Add Contact Point Dialog -->
<SfDialog @bind-Visible="showAddContactDialog"
		  Width="500px"
		  IsModal="true">
	<DialogTemplates>
		<Header>Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ø§ØªØµØ§Ù„ Ø¬Ø¯ÙŠØ¯Ø©</Header>
		<Content>
			<div class="contact-point-form">
				<SfDropDownList TValue="string"
								TItem="ContactTypeOption"
								@bind-Value="newContactPoint.Type"
								DataSource="@contactTypeOptions"
								FloatLabelType="FloatLabelType.Auto">
					<DropDownListFieldSettings Text="Label" Value="Value" />
					<label>Ø§Ù„Ù†ÙˆØ¹</label>
				</SfDropDownList>

				<SfTextBox @bind-Value="newContactPoint.Value"
						   Placeholder="@GetPlaceholder(newContactPoint.Type)"
						   FloatLabelType="FloatLabelType.Auto">
					<label>Ø§Ù„Ù‚ÙŠÙ…Ø©</label>
				</SfTextBox>

				<SfTextBox @bind-Value="newContactPoint.Label"
						   FloatLabelType="FloatLabelType.Auto">
					<label>Ø§Ù„ØªØ³Ù…ÙŠØ© (Ù…Ø«Ù„Ø§Ù‹: Ù…Ù†Ø²Ù„ØŒ Ø¹Ù…Ù„)</label>
				</SfTextBox>

				<SfCheckBox @bind-Checked="newContactPoint.SetAsPrimary"
							Label="ØªØ¹ÙŠÙŠÙ† ÙƒØ£Ø³Ø§Ø³ÙŠ"
							TChecked="bool" />
			</div>
		</Content>
		<FooterTemplate>
			<SfButton IsPrimary="true" OnClick="AddContactPoint">Ø¥Ø¶Ø§ÙØ©</SfButton>
			<SfButton OnClick="() => showAddContactDialog = false">Ø¥Ù„ØºØ§Ø¡</SfButton>
		</FooterTemplate>
	</DialogTemplates>
</SfDialog>

<!-- Verify Contact Point Dialog -->
<SfDialog @bind-Visible="showVerifyDialog"
		  Width="400px"
		  IsModal="true">
	<DialogTemplates>
		<Header>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ù‚Ø·Ø© Ø§Ù„Ø§ØªØµØ§Ù„</Header>
		<Content>
			<div class="verify-form">
				<p>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ @verifyingContactValue</p>
				<SfTextBox @bind-Value="verificationCode"
						   Placeholder="XXXXXX"
						   CssClass="verification-input"
						   FloatLabelType="FloatLabelType.Auto">
					<label>Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</label>
				</SfTextBox>
			</div>
		</Content>
		<FooterTemplate>
			<SfButton IsPrimary="true" OnClick="ConfirmVerification">ØªØ­Ù‚Ù‚</SfButton>
			<SfButton OnClick="() => showVerifyDialog = false">Ø¥Ù„ØºØ§Ø¡</SfButton>
		</FooterTemplate>
	</DialogTemplates>
</SfDialog>

@code {
	private ProfileDto? profile;
	private List<ContactPointDto>? contactPoints;
	private bool isLoadingProfile = true;
	private bool isLoadingContactPoints = true;
	private bool isSaving = false;

	// Contact Points
	private bool showAddContactDialog = false;
	private bool showVerifyDialog = false;
	private AddContactPointRequest newContactPoint = new();
	private Guid verifyingContactId;
	private string verifyingContactValue = "";
	private string verificationCode = "";

	// Security
	private bool twoFactorEnabled = false;
	private bool showChangePasswordDialog = false;

	// Preferences
	private string selectedLanguage = "ar";
	private string selectedCurrency = "SAR";
	private bool emailNotifications = true;
	private bool smsNotifications = true;
	private bool pushNotifications = true;

	private List<GenderOption> genderOptions = new()
	{
		new() { Value = "Male", Label = "Ø°ÙƒØ±" },
		new() { Value = "Female", Label = "Ø£Ù†Ø«Ù‰" },
		new() { Value = "Other", Label = "Ø¢Ø®Ø±" }
	};

	private List<ContactTypeOption> contactTypeOptions = new()
	{
		new() { Value = "Email", Label = "Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" },
		new() { Value = "Phone", Label = "Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„" },
		new() { Value = "Address", Label = "Ø¹Ù†ÙˆØ§Ù†" },
		new() { Value = "Social", Label = "Ø­Ø³Ø§Ø¨ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ" }
	};

	private List<LanguageOption> languageOptions = new()
	{
		new() { Value = "ar", Label = "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" },
		new() { Value = "en", Label = "English" }
	};

	private List<CurrencyOption> currencyOptions = new()
	{
		new() { Value = "SAR", Label = "Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (SAR)" },
		new() { Value = "USD", Label = "Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)" },
		new() { Value = "EUR", Label = "ÙŠÙˆØ±Ùˆ (EUR)" }
	};

	protected override async Task OnInitializedAsync()
	{
		await LoadProfile();
		await LoadContactPoints();
	}

	private async Task LoadProfile()
	{
		isLoadingProfile = true;
		try
		{
			// TODO: Map from ACommerce.Client.Profiles.ProfileDto to local ProfileDto
			// var sdkProfile = await ProfilesClient.GetMyProfileAsync();
			// For now using mock data
			profile = new ProfileDto
			{
				Id = Guid.NewGuid(),
				FullName = "Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ",
				Username = "demo_user",
				DateOfBirth = new DateTime(1990, 1, 1),
				Gender = "Male",
				Bio = "Ù†Ø¨Ø°Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©",
				TwoFactorEnabled = false
			};
			twoFactorEnabled = profile.TwoFactorEnabled;
			await Task.Delay(100); // Simulate load
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ: {ex.Message}");
		}
		finally
		{
			isLoadingProfile = false;
		}
	}

	private async Task LoadContactPoints()
	{
		isLoadingContactPoints = true;
		try
		{
			// TODO: Map from ACommerce.Client.ContactPoints.ContactPoint to local ContactPointDto
			// var sdkContacts = await ContactPointsClient.GetMyContactPointsAsync();
			// For now using mock data
			contactPoints = new List<ContactPointDto>
			{
				new() { Id = Guid.NewGuid(), Type = "Email", Value = "demo@example.com", Label = "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ", IsPrimary = true, IsVerified = true },
				new() { Id = Guid.NewGuid(), Type = "Phone", Value = "0501234567", Label = "Ø§Ù„Ø¬ÙˆØ§Ù„", IsPrimary = false, IsVerified = false }
			};
			await Task.Delay(100); // Simulate load
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ù‚Ø§Ø· Ø§Ù„Ø§ØªØµØ§Ù„: {ex.Message}");
		}
		finally
		{
			isLoadingContactPoints = false;
		}
	}

	private async Task SaveProfile()
	{
		if (profile == null) return;

		isSaving = true;
		try
		{
			// TODO: Map to ACommerce.Client.Profiles.UpdateProfileRequest and call SDK
			// await ProfilesClient.UpdateMyProfileAsync(new Client.Profiles.UpdateProfileRequest { ... });
			// For now simulating save
			await Task.Delay(500);
			Notification.ShowSuccess("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª");
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø®Ø·Ø£: {ex.Message}");
		}
		finally
		{
			isSaving = false;
		}
	}

	// Contact Points Management
	private void ShowAddContactPointDialog()
	{
		newContactPoint = new AddContactPointRequest { Type = "Email" };
		showAddContactDialog = true;
	}

	private async Task AddContactPoint()
	{
		try
		{
			// TODO: Map to ACommerce.Client.ContactPoints.AddContactPointRequest and call SDK
			// var result = await ContactPointsClient.AddContactPointAsync(...);
			// For now simulating add
			var newContact = new ContactPointDto
			{
				Id = Guid.NewGuid(),
				Type = newContactPoint.Type,
				Value = newContactPoint.Value,
				Label = newContactPoint.Label,
				IsPrimary = newContactPoint.SetAsPrimary,
				IsVerified = false
			};
			contactPoints ??= new();
			contactPoints.Add(newContact);
			showAddContactDialog = false;
			Notification.ShowSuccess("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­");

			// Verify if needed
			if (!newContact.IsVerified)
			{
				await VerifyContactPoint(newContact.Id);
			}
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø®Ø·Ø£: {ex.Message}");
		}
	}

	private async Task VerifyContactPoint(Guid contactPointId)
	{
		try
		{
			var cp = contactPoints?.FirstOrDefault(c => c.Id == contactPointId);
			if (cp == null) return;

			var result = await ContactPointsClient.RequestVerificationAsync(contactPointId);
			if (result != null)
			{
				verifyingContactId = contactPointId;
				verifyingContactValue = cp.Value;
				verificationCode = "";
				showVerifyDialog = true;
				Notification.ShowSuccess("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚");
			}
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø®Ø·Ø£: {ex.Message}");
		}
	}

	private async Task ConfirmVerification()
	{
		try
		{
			var result = await ContactPointsClient.VerifyCodeAsync(verifyingContactId, verificationCode);
			if (result != null)
			{
				// Update local state
				var cp = contactPoints?.FirstOrDefault(c => c.Id == verifyingContactId);
				if (cp != null)
				{
					cp.IsVerified = true;
				}
				showVerifyDialog = false;
				Notification.ShowSuccess("ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­");
			}
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­");
		}
	}

	private async Task SetPrimary(Guid contactPointId)
	{
		try
		{
			var result = await ContactPointsClient.SetPrimaryAsync(contactPointId);
			if (result != null)
			{
				// Update all contact points
				foreach (var cp in contactPoints ?? new())
				{
					cp.IsPrimary = cp.Id == contactPointId;
				}
				StateHasChanged();
				Notification.ShowSuccess("ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ† ÙƒØ£Ø³Ø§Ø³ÙŠ");
			}
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø®Ø·Ø£: {ex.Message}");
		}
	}

	private void EditContactPoint(ContactPointDto cp)
	{
		// Show edit dialog (similar to add)
		Notification.ShowInfo("Ù…ÙŠØ²Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø±ÙŠØ¨Ø§Ù‹");
	}

	private async Task DeleteContactPoint(Guid contactPointId)
	{
		try
		{
			await ContactPointsClient.DeleteContactPointAsync(contactPointId);
			contactPoints?.RemoveAll(c => c.Id == contactPointId);
			StateHasChanged();
			Notification.ShowSuccess("ØªÙ… Ø§Ù„Ø­Ø°Ù");
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø®Ø·Ø£: {ex.Message}");
		}
	}

	private string GetContactPointIcon(string type) => type switch
	{
		"Email" => "ğŸ“§",
		"Phone" => "ğŸ“±",
		"Address" => "ğŸ“",
		"Social" => "ğŸŒ",
		_ => "ğŸ“‡"
	};

	private string GetPlaceholder(string type) => type switch
	{
		"Email" => "example@domain.com",
		"Phone" => "05XXXXXXXX",
		"Address" => "Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ",
		"Social" => "@username Ø£Ùˆ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ",
		_ => ""
	};

	// Other methods
	private void ChangeAvatar()
	{
		Notification.ShowInfo("Ù…ÙŠØ²Ø© ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹");
	}

	private void ShowChangePasswordDialog()
	{
		Notification.ShowInfo("Ù…ÙŠØ²Ø© ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‚Ø±ÙŠØ¨Ø§Ù‹");
	}

	private async Task ToggleTwoFactor(Syncfusion.Blazor.Buttons.ChangeEventArgs<bool> args)
	{
		try
		{
			// TODO: Implement two-factor toggle with AuthClient
			// await AuthClient.ToggleTwoFactorAsync(twoFactorEnabled);
			await Task.Delay(300); // Simulate API call
			Notification.ShowSuccess(twoFactorEnabled ? "ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©" : "ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©");
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø®Ø·Ø£: {ex.Message}");
			twoFactorEnabled = !twoFactorEnabled; // Revert
		}
	}

	private async Task OnLanguageChanged(ChangeEventArgs<string, LanguageOption> args)
	{
		// Update language preference
		Notification.ShowSuccess($"ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ø¥Ù„Ù‰ {args.ItemData?.Label}");
	}

	private async Task SavePreferences()
	{
		Notification.ShowSuccess("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª");
	}

	private string GetAvatarInitials(string name)
	{
		if (string.IsNullOrEmpty(name)) return "?";
		var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
		if (parts.Length >= 2)
			return $"{parts[0][0]}{parts[1][0]}".ToUpper();
		return name[0].ToString().ToUpper();
	}

	// Models
	private class ProfileDto
	{
		public Guid Id { get; set; }
		public string FullName { get; set; } = string.Empty;
		public string Username { get; set; } = string.Empty;
		public string? AvatarUrl { get; set; }
		public DateTime? DateOfBirth { get; set; }
		public string? Gender { get; set; }
		public string? Bio { get; set; }
		public bool TwoFactorEnabled { get; set; }
	}

	private class ContactPointDto
	{
		public Guid Id { get; set; }
		public string Type { get; set; } = string.Empty;
		public string Value { get; set; } = string.Empty;
		public string Label { get; set; } = string.Empty;
		public bool IsPrimary { get; set; }
		public bool IsVerified { get; set; }
	}

	private class UpdateProfileRequest
	{
		public string? FullName { get; set; }
		public string? Username { get; set; }
		public DateTime? DateOfBirth { get; set; }
		public string? Gender { get; set; }
		public string? Bio { get; set; }
	}

	private class AddContactPointRequest
	{
		public string Type { get; set; } = string.Empty;
		public string Value { get; set; } = string.Empty;
		public string Label { get; set; } = string.Empty;
		public bool SetAsPrimary { get; set; }
	}

	private class GenderOption
	{
		public string Value { get; set; } = string.Empty;
		public string Label { get; set; } = string.Empty;
	}

	private class ContactTypeOption
	{
		public string Value { get; set; } = string.Empty;
		public string Label { get; set; } = string.Empty;
	}

	private class LanguageOption
	{
		public string Value { get; set; } = string.Empty;
		public string Label { get; set; } = string.Empty;
	}

	private class CurrencyOption
	{
		public string Value { get; set; } = string.Empty;
		public string Label { get; set; } = string.Empty;
	}
}

<style>
	.profile-page {
		padding: var(--spacing-lg);
		max-width: 1200px;
		margin: 0 auto;
	}

	.section-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: var(--spacing-md);
	}

	/* Profile Section */
	.profile-section {
		padding: var(--spacing-lg);
	}

	.profile-avatar-section {
		text-align: center;
		margin-bottom: var(--spacing-xl);
	}

	.profile-avatar-large {
		width: 120px;
		height: 120px;
		border-radius: 50%;
		background: var(--primary-color);
		color: white;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 48px;
		font-weight: 600;
		margin: 0 auto var(--spacing-md) auto;
	}

	.form-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
		gap: var(--spacing-lg);
		margin-bottom: var(--spacing-xl);
	}

	.form-actions {
		display: flex;
		justify-content: flex-end;
		gap: var(--spacing-sm);
	}

	/* Contact Points */
	.contact-points-list {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-md);
	}

	.contact-point-item {
		display: flex;
		gap: var(--spacing-md);
		padding: var(--spacing-md);
		border: 1px solid var(--border-color);
		border-radius: var(--border-radius);
		align-items: center;
	}

	.cp-icon {
		width: 48px;
		height: 48px;
		border-radius: 50%;
		background: var(--bg-secondary);
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 24px;
		flex-shrink: 0;
	}

	.cp-info {
		flex: 1;
	}

	.cp-header {
		display: flex;
		gap: var(--spacing-sm);
		align-items: center;
		margin-bottom: var(--spacing-xs);
	}

	.primary-badge {
		background: var(--primary-color);
		color: white;
		padding: 2px 8px;
		border-radius: 12px;
		font-size: var(--font-size-xs);
		font-weight: 600;
	}

	.verified-badge {
		background: var(--success-color);
		color: white;
		padding: 2px 8px;
		border-radius: 12px;
		font-size: var(--font-size-xs);
		font-weight: 600;
	}

	.cp-meta {
		display: flex;
		gap: var(--spacing-md);
		font-size: var(--font-size-sm);
		color: var(--text-secondary);
	}

	.cp-actions {
		display: flex;
		gap: var(--spacing-xs);
	}

	.verify-btn {
		background: var(--warning-color);
		color: white;
	}

	/* Security */
	.security-section {
		padding: var(--spacing-lg);
		display: flex;
		flex-direction: column;
		gap: var(--spacing-lg);
	}

	.security-item {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: var(--spacing-md);
		border: 1px solid var(--border-color);
		border-radius: var(--border-radius);
	}

	.security-info h4 {
		margin: 0 0 var(--spacing-xs) 0;
	}

	.security-info p {
		margin: 0;
		font-size: var(--font-size-sm);
		color: var(--text-secondary);
	}

	/* Preferences */
	.preferences-section {
		padding: var(--spacing-lg);
	}

	.preference-group {
		margin-bottom: var(--spacing-lg);
	}

	.preference-group h4 {
		margin-bottom: var(--spacing-md);
	}

	/* Dialogs */
	.contact-point-form,
	.verify-form {
		padding: var(--spacing-md);
		display: flex;
		flex-direction: column;
		gap: var(--spacing-md);
	}

	.verification-input {
		text-align: center;
		font-size: 24px;
		letter-spacing: 8px;
	}

	.empty-state {
		text-align: center;
		padding: var(--spacing-xl);
	}

	.empty-icon {
		font-size: 64px;
		margin-bottom: var(--spacing-md);
		opacity: 0.5;
	}

	.loading-container {
		text-align: center;
		padding: var(--spacing-xl);
	}
</style>
