@page "/register"
@inject AuthClient AuthClient
@inject NavigationManager Navigation
@inject NotificationService Notification

<PageTitle>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ - Register</PageTitle>

<div class="auth-container">
	<SfCard CssClass="auth-card">
		<CardHeader Title="Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯" />
		<CardContent>
			<EditForm Model="@registerModel" OnValidSubmit="HandleRegister">
				<DataAnnotationsValidator />
				<ValidationSummary />

				<SfTextBox @bind-Value="registerModel.FullName"
						   Placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"
						   FloatLabelType="FloatLabelType.Auto">
					<label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
				</SfTextBox>

				<SfTextBox @bind-Value="registerModel.Email"
						   Placeholder="example@domain.com"
						   FloatLabelType="FloatLabelType.Auto">
					<label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
				</SfTextBox>

				<SfTextBox @bind-Value="registerModel.PhoneNumber"
						   Placeholder="05XXXXXXXX"
						   FloatLabelType="FloatLabelType.Auto">
					<label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
				</SfTextBox>

				<SfTextBox @bind-Value="registerModel.Password"
						   Type="InputType.Password"
						   FloatLabelType="FloatLabelType.Auto">
					<label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
				</SfTextBox>

				<SfTextBox @bind-Value="registerModel.ConfirmPassword"
						   Type="InputType.Password"
						   FloatLabelType="FloatLabelType.Auto">
					<label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
				</SfTextBox>

				<div class="checkbox-container">
					<SfCheckBox @bind-Checked="registerModel.AgreeToTerms" Label="Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…" />
				</div>

				<div class="auth-actions">
					<SfButton Type="Submit" IsPrimary="true" Disabled="@isLoading">
						@if (isLoading) { <SfSpinner /> } else { <span>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</span> }
					</SfButton>
					<SfButton OnClick="() => Navigation.NavigateTo(\"/login\")">
						Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
					</SfButton>
				</div>
			</EditForm>

			<div class="divider">
				<span>Ø£Ùˆ</span>
			</div>

			<div class="social-auth">
				<SfButton CssClass="social-btn google-btn" OnClick="RegisterWithGoogle">
					<span class="icon">ğŸ”µ</span>
					<span>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¹Ø¨Ø± Google</span>
				</SfButton>

				<SfButton CssClass="social-btn apple-btn" OnClick="RegisterWithApple">
					<span class="icon">ğŸ</span>
					<span>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¹Ø¨Ø± Apple</span>
				</SfButton>
			</div>
		</CardContent>
	</SfCard>
</div>

@code {
	private RegisterModel registerModel = new();
	private bool isLoading = false;

	private async Task HandleRegister()
	{
		if (registerModel.Password != registerModel.ConfirmPassword)
		{
			Notification.ShowError("ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©");
			return;
		}

		if (!registerModel.AgreeToTerms)
		{
			Notification.ShowError("ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…");
			return;
		}

		isLoading = true;
		try
		{
			var result = await AuthClient.RegisterAsync(new RegisterRequest
			{
				FullName = registerModel.FullName,
				Email = registerModel.Email,
				PhoneNumber = registerModel.PhoneNumber,
				Password = registerModel.Password
			});

			if (result?.Success == true)
			{
				// Redirect to verify email/phone
				if (!string.IsNullOrEmpty(registerModel.Email))
				{
					Navigation.NavigateTo($"/auth/verify-email?email={registerModel.Email}");
				}
				else
				{
					Navigation.NavigateTo("/login");
				}
				Notification.ShowSuccess("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
			}
			else
			{
				Notification.ShowError(result?.Message ?? "ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨");
			}
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø®Ø·Ø£: {ex.Message}");
		}
		finally
		{
			isLoading = false;
		}
	}

	private void RegisterWithGoogle()
	{
		Navigation.NavigateTo("/api/auth/external/google?mode=register", forceLoad: true);
	}

	private void RegisterWithApple()
	{
		Navigation.NavigateTo("/api/auth/external/apple?mode=register", forceLoad: true);
	}

	private class RegisterModel
	{
		public string FullName { get; set; } = string.Empty;
		public string Email { get; set; } = string.Empty;
		public string PhoneNumber { get; set; } = string.Empty;
		public string Password { get; set; } = string.Empty;
		public string ConfirmPassword { get; set; } = string.Empty;
		public bool AgreeToTerms { get; set; }
	}
}

<style>
	.auth-container {
		display: flex;
		justify-content: center;
		align-items: center;
		min-height: 80vh;
		padding: var(--spacing-lg);
	}

	.auth-card {
		width: 100%;
		max-width: 500px;
	}

	.checkbox-container {
		margin: var(--spacing-md) 0;
	}

	.auth-actions {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-sm);
		margin-top: var(--spacing-lg);
	}

	.divider {
		text-align: center;
		margin: var(--spacing-lg) 0;
		position: relative;
	}

	.divider::before {
		content: '';
		position: absolute;
		top: 50%;
		left: 0;
		right: 0;
		height: 1px;
		background: var(--border-color);
	}

	.divider span {
		background: var(--bg-primary);
		padding: 0 var(--spacing-md);
		position: relative;
		z-index: 1;
	}

	.social-auth {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-sm);
	}

	.social-btn {
		width: 100%;
		display: flex;
		align-items: center;
		gap: var(--spacing-sm);
	}

	.social-btn .icon {
		font-size: 20px;
	}
</style>
