@page "/"
@inject ProductsClient ProductsClient
@inject ProductListingsClient ListingsClient
@inject CategoriesClient CategoriesClient
@inject CartStateService CartState
@inject NavigationManager Navigation
@inject NotificationService Notification

<PageTitle>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Home</PageTitle>

<div class="home-page">
	<!-- Hero Section -->
	<section class="hero-section">
		<SfCarousel>
			<CarouselItems>
				<CarouselItem>
					<div class="hero-slide" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
						<div class="hero-content">
							<h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ØªØ¬Ø±Ù†Ø§</h1>
							<p>Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø¢Ù„Ø§Ù Ø§Ù„ØªØ¬Ø§Ø±</p>
							<SfButton CssClass="hero-btn" OnClick="() => Navigation.NavigateTo(\"/products\")">
								ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
							</SfButton>
						</div>
					</div>
				</CarouselItem>
				<CarouselItem>
					<div class="hero-slide" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
						<div class="hero-content">
							<h1>Ø¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ©</h1>
							<p>Ø®ØµÙˆÙ…Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 70%</p>
							<SfButton CssClass="hero-btn" OnClick="() => Navigation.NavigateTo(\"/products?filter=sale\")">
								ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†
							</SfButton>
						</div>
					</div>
				</CarouselItem>
				<CarouselItem>
					<div class="hero-slide" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
						<div class="hero-content">
							<h1>Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ</h1>
							<p>Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙˆÙ‚ 200 Ø±ÙŠØ§Ù„</p>
							<SfButton CssClass="hero-btn" OnClick="() => Navigation.NavigateTo(\"/products\")">
								Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚
							</SfButton>
						</div>
					</div>
				</CarouselItem>
			</CarouselItems>
		</SfCarousel>
	</section>

	<!-- Categories -->
	<section class="categories-section">
		<h2>Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</h2>
		<div class="categories-grid">
			@if (categories == null)
			{
				<SfSpinner />
			}
			else
			{
				@foreach (var category in categories.Take(8))
				{
					<SfCard CssClass="category-card" OnClick="() => Navigation.NavigateTo($\"/products?category={category.Id}\")">
						<CardContent>
							<div class="category-icon">@GetCategoryIcon(category.Name)</div>
							<h4>@category.Name</h4>
							<p class="category-count">@category.ProductCount Ù…Ù†ØªØ¬</p>
						</CardContent>
					</SfCard>
				}
			}
		</div>
	</section>

	<!-- Featured Products -->
	<section class="featured-section">
		<div class="section-header">
			<h2>Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…ÙŠØ²Ø©</h2>
			<SfButton OnClick="() => Navigation.NavigateTo(\"/products\")">
				Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
			</SfButton>
		</div>

		@if (featuredProducts == null)
		{
			<div class="loading-container">
				<SfSpinner />
			</div>
		}
		else
		{
			<div class="products-grid">
				@foreach (var listing in featuredProducts)
				{
					<ProductCard Listing="@listing" OnAddToCart="HandleAddToCart" />
				}
			</div>
		}
	</section>

	<!-- New Arrivals -->
	<section class="new-arrivals-section">
		<div class="section-header">
			<h2>ÙˆØµÙ„ Ø­Ø¯ÙŠØ«Ø§Ù‹</h2>
			<SfButton OnClick="() => Navigation.NavigateTo(\"/products?sort=newest\")">
				Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
			</SfButton>
		</div>

		@if (newProducts == null)
		{
			<div class="loading-container">
				<SfSpinner />
			</div>
		}
		else
		{
			<div class="products-grid">
				@foreach (var listing in newProducts)
				{
					<ProductCard Listing="@listing" OnAddToCart="HandleAddToCart" />
				}
			</div>
		}
	</section>

	<!-- Best Sellers -->
	<section class="bestsellers-section">
		<div class="section-header">
			<h2>Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</h2>
			<SfButton OnClick="() => Navigation.NavigateTo(\"/products?sort=bestsellers\")">
				Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
			</SfButton>
		</div>

		@if (bestSellers == null)
		{
			<div class="loading-container">
				<SfSpinner />
			</div>
		}
		else
		{
			<div class="products-grid">
				@foreach (var listing in bestSellers)
				{
					<ProductCard Listing="@listing" OnAddToCart="HandleAddToCart" />
				}
			</div>
		}
	</section>
</div>

@code {
	private List<CategoryDto>? categories;
	private List<ProductListingDto>? featuredProducts;
	private List<ProductListingDto>? newProducts;
	private List<ProductListingDto>? bestSellers;

	protected override async Task OnInitializedAsync()
	{
		await LoadAllData();
	}

	private async Task LoadAllData()
	{
		try
		{
			// Load all data in parallel
			var categoriesTask = CategoriesClient.GetAllAsync();
			var featuredTask = ListingsClient.SearchAsync(new SearchListingsRequest
			{
				IsFeatured = true,
				PageSize = 8
			});
			var newTask = ListingsClient.SearchAsync(new SearchListingsRequest
			{
				SortBy = "CreatedAt",
				SortDescending = true,
				PageSize = 8
			});
			var bestsellersTask = ListingsClient.SearchAsync(new SearchListingsRequest
			{
				SortBy = "Sales",
				SortDescending = true,
				PageSize = 8
			});

			await Task.WhenAll(categoriesTask, featuredTask, newTask, bestsellersTask);

			categories = await categoriesTask;
			featuredProducts = (await featuredTask)?.Items;
			newProducts = (await newTask)?.Items;
			bestSellers = (await bestsellersTask)?.Items;
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: {ex.Message}");
		}
	}

	private async Task HandleAddToCart(Guid listingId)
	{
		var success = await CartState.AddToCartAsync(listingId, 1);
		if (success)
		{
			Notification.ShowSuccess("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©");
		}
	}

	private string GetCategoryIcon(string categoryName)
	{
		return categoryName.ToLower() switch
		{
			var n when n.Contains("Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª") || n.Contains("electronics") => "ğŸ“±",
			var n when n.Contains("Ù…Ù„Ø§Ø¨Ø³") || n.Contains("fashion") || n.Contains("clothes") => "ğŸ‘•",
			var n when n.Contains("ÙƒØªØ¨") || n.Contains("books") => "ğŸ“š",
			var n when n.Contains("Ø±ÙŠØ§Ø¶Ø©") || n.Contains("sports") => "âš½",
			var n when n.Contains("Ø¬Ù…Ø§Ù„") || n.Contains("beauty") => "ğŸ’„",
			var n when n.Contains("Ù…Ù†Ø²Ù„") || n.Contains("home") => "ğŸ ",
			var n when n.Contains("Ø·Ø¹Ø§Ù…") || n.Contains("food") => "ğŸ”",
			var n when n.Contains("Ø£Ù„Ø¹Ø§Ø¨") || n.Contains("games") || n.Contains("toys") => "ğŸ®",
			_ => "ğŸ“¦"
		};
	}

	// Models (shared with backend)
	private class CategoryDto
	{
		public Guid Id { get; set; }
		public string Name { get; set; } = string.Empty;
		public int ProductCount { get; set; }
	}

	private class ProductListingDto
	{
		public Guid Id { get; set; }
		public string ProductName { get; set; } = string.Empty;
		public decimal Price { get; set; }
		public string? ImageUrl { get; set; }
		public bool IsFeatured { get; set; }
		public Dictionary<string, object> Properties { get; set; } = new();
	}

	private class SearchListingsRequest
	{
		public bool? IsFeatured { get; set; }
		public string? SortBy { get; set; }
		public bool SortDescending { get; set; }
		public int PageSize { get; set; } = 10;
	}
}

<style>
	.home-page {
		width: 100%;
	}

	/* Hero Section */
	.hero-section {
		margin-bottom: var(--spacing-xl);
	}

	.hero-slide {
		height: 400px;
		display: flex;
		align-items: center;
		justify-content: center;
		border-radius: var(--border-radius);
	}

	.hero-content {
		text-align: center;
		color: white;
		padding: var(--spacing-xl);
	}

	.hero-content h1 {
		font-size: 48px;
		margin-bottom: var(--spacing-md);
		font-weight: 700;
	}

	.hero-content p {
		font-size: 20px;
		margin-bottom: var(--spacing-lg);
	}

	.hero-btn {
		background: white;
		color: var(--primary-color);
		padding: var(--spacing-md) var(--spacing-xl);
		font-size: 18px;
		font-weight: 600;
	}

	/* Categories */
	.categories-section {
		margin-bottom: var(--spacing-xl);
	}

	.categories-section h2 {
		margin-bottom: var(--spacing-lg);
	}

	.categories-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
		gap: var(--spacing-md);
	}

	.category-card {
		cursor: pointer;
		transition: transform 0.2s, box-shadow 0.2s;
		text-align: center;
		padding: var(--spacing-lg);
	}

	.category-card:hover {
		transform: translateY(-4px);
		box-shadow: var(--shadow-lg);
	}

	.category-icon {
		font-size: 48px;
		margin-bottom: var(--spacing-sm);
	}

	.category-count {
		color: var(--text-secondary);
		font-size: var(--font-size-sm);
	}

	/* Sections */
	.section-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: var(--spacing-lg);
	}

	.products-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
		gap: var(--spacing-lg);
	}

	.loading-container {
		text-align: center;
		padding: var(--spacing-xl);
	}

	.featured-section,
	.new-arrivals-section,
	.bestsellers-section {
		margin-bottom: var(--spacing-xl);
	}
</style>
