@page "/orders"
@inject OrdersClient OrdersClient
@inject NavigationManager Navigation
@inject NotificationService Notification

<PageTitle>Ø·Ù„Ø¨Ø§ØªÙŠ - My Orders</PageTitle>

<div class="orders-page">
	<h1>Ø·Ù„Ø¨Ø§ØªÙŠ</h1>

	@if (isLoading)
	{
		<div class="loading-container">
			<SfSpinner />
		</div>
	}
	else if (orders == null || !orders.Any())
	{
		<div class="empty-state">
			<div class="empty-icon">ğŸ“‹</div>
			<h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</h3>
			<p>Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚ ÙˆØ§Ø·Ù„Ø¨ Ù…Ù†ØªØ¬Ø§ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©</p>
			<SfButton IsPrimary="true" OnClick="@(() => Navigation.NavigateTo("/products"))">
				ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
			</SfButton>
		</div>
	}
	else
	{
		<SfTab>
			<TabItems>
				<TabItem>
					<ChildContent>
						<TabHeader Text="@($"Ø§Ù„ÙƒÙ„ ({orders.Count})")" />
					</ChildContent>
					<ContentTemplate>
						<OrdersList Items="@orders" OnViewDetails="ViewOrderDetails" />
					</ContentTemplate>
				</TabItem>

				<TabItem>
					<ChildContent>
						<TabHeader Text="@($"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ({pendingOrders.Count})")" />
					</ChildContent>
					<ContentTemplate>
						<OrdersList Items="@pendingOrders" OnViewDetails="ViewOrderDetails" />
					</ContentTemplate>
				</TabItem>

				<TabItem>
					<ChildContent>
						<TabHeader Text="@($"Ù‚ÙŠØ¯ Ø§Ù„Ø´Ø­Ù† ({shippingOrders.Count})")" />
					</ChildContent>
					<ContentTemplate>
						<OrdersList Items="@shippingOrders" OnViewDetails="ViewOrderDetails" />
					</ContentTemplate>
				</TabItem>

				<TabItem>
					<ChildContent>
						<TabHeader Text="@($"Ù…ÙƒØªÙ…Ù„Ø© ({completedOrders.Count})")" />
					</ChildContent>
					<ContentTemplate>
						<OrdersList Items="@completedOrders" OnViewDetails="ViewOrderDetails" />
					</ContentTemplate>
				</TabItem>
			</TabItems>
		</SfTab>
	}
</div>

@code {
	private List<Components.OrdersList.OrderDto>? orders;
	private List<Components.OrdersList.OrderDto> pendingOrders => orders?.Where(o => o.Status == "Pending" || o.Status == "Processing").ToList() ?? new();
	private List<Components.OrdersList.OrderDto> shippingOrders => orders?.Where(o => o.Status == "Shipped" || o.Status == "InTransit").ToList() ?? new();
	private List<Components.OrdersList.OrderDto> completedOrders => orders?.Where(o => o.Status == "Delivered" || o.Status == "Completed").ToList() ?? new();

	private bool isLoading = true;

	protected override async Task OnInitializedAsync()
	{
		await LoadOrders();
	}

	private async Task LoadOrders()
	{
		isLoading = true;
		try
		{
			// TODO: Map from ACommerce.Client.Orders.OrderDto to local OrderDto
			// var sdkOrders = await OrdersClient.GetMyOrdersAsync();
			// For now using mock data
			orders = new List<Components.OrdersList.OrderDto>
			{
				new() { Id = Guid.NewGuid(), OrderNumber = "ORD-001", Status = "Pending", Total = 150.00m, CreatedAt = DateTime.Now.AddDays(-1), ItemsCount = 3 },
				new() { Id = Guid.NewGuid(), OrderNumber = "ORD-002", Status = "Shipped", Total = 89.99m, CreatedAt = DateTime.Now.AddDays(-5), ItemsCount = 1 },
				new() { Id = Guid.NewGuid(), OrderNumber = "ORD-003", Status = "Delivered", Total = 250.00m, CreatedAt = DateTime.Now.AddDays(-10), ItemsCount = 5 }
			};
			await Task.Delay(100); // Simulate load
		}
		catch (Exception ex)
		{
			Notification.ShowError($"Ø®Ø·Ø£: {ex.Message}");
		}
		finally
		{
			isLoading = false;
		}
	}

	private void ViewOrderDetails(Guid orderId)
	{
		Navigation.NavigateTo($"/orders/{orderId}");
	}
}

<style>
	.orders-page {
		max-width: 1200px;
		margin: 0 auto;
		padding: var(--spacing-lg);
	}

	.orders-page h1 {
		margin-bottom: var(--spacing-xl);
	}

	.empty-state {
		text-align: center;
		padding: var(--spacing-xl) 0;
	}

	.empty-icon {
		font-size: 80px;
		margin-bottom: var(--spacing-md);
		opacity: 0.3;
	}

	.loading-container {
		text-align: center;
		padding: var(--spacing-xl);
	}
</style>
