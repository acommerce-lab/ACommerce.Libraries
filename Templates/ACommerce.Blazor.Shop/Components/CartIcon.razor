@inject CartStateService CartState
@inject NavigationManager Navigation
@implements IDisposable

<div class="cart-icon-container" @onclick="GoToCart">
	<span class="cart-icon">ðŸ›’</span>
	@if (CartState.ItemCount > 0)
	{
		<span class="cart-badge">@CartState.ItemCount</span>
	}
	<div class="cart-info">
		<span class="cart-total">@CartState.Total.ToString("C")</span>
	</div>
</div>

@code {
	protected override async Task OnInitializedAsync()
	{
		await CartState.LoadCartAsync();
		CartState.OnCartChanged += StateHasChanged;
	}

	private void GoToCart()
	{
		Navigation.NavigateTo("/cart");
	}

	public void Dispose()
	{
		CartState.OnCartChanged -= StateHasChanged;
	}
}

<style>
	.cart-icon-container {
		display: flex;
		align-items: center;
		gap: var(--spacing-sm);
		padding: var(--spacing-sm) var(--spacing-md);
		border-radius: var(--border-radius);
		cursor: pointer;
		transition: background 0.2s;
		position: relative;
	}

	.cart-icon-container:hover {
		background: var(--bg-secondary);
	}

	.cart-icon {
		font-size: 24px;
		position: relative;
	}

	.cart-badge {
		position: absolute;
		top: -8px;
		right: -8px;
		background: var(--error-color);
		color: white;
		border-radius: 50%;
		width: 20px;
		height: 20px;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 11px;
		font-weight: 600;
	}

	.cart-info {
		display: flex;
		flex-direction: column;
	}

	.cart-total {
		font-weight: 600;
		color: var(--price-color);
	}
</style>
