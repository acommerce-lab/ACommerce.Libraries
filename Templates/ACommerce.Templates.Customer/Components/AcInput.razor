@namespace ACommerce.Templates.Customer.Components

<div class="ac-form-group @(HasError ? "ac-has-error" : "") @Class">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="ac-label" for="@Id">
            @Label
            @if (Required)
            {
                <span class="ac-required">*</span>
            }
        </label>
    }

    <div class="ac-input-wrapper">
        @if (!string.IsNullOrEmpty(IconStart))
        {
            <span class="ac-input-icon ac-input-icon-start">
                <i class="@IconStart"></i>
            </span>
        }

        @if (Type == "textarea")
        {
            <textarea id="@Id"
                      class="ac-input ac-textarea @(HasError ? "ac-input-error" : "")"
                      placeholder="@Placeholder"
                      disabled="@Disabled"
                      readonly="@ReadOnly"
                      rows="@Rows"
                      @bind="Value"
                      @bind:event="oninput"
                      @onfocus="HandleFocus"
                      @onblur="HandleBlur"
                      @attributes="AdditionalAttributes"></textarea>
        }
        else
        {
            <input id="@Id"
                   type="@Type"
                   class="ac-input @InputSizeClass @(HasError ? "ac-input-error" : "") @(IconStart != null ? "ac-input-with-icon-start" : "") @(IconEnd != null ? "ac-input-with-icon-end" : "")"
                   placeholder="@Placeholder"
                   disabled="@Disabled"
                   readonly="@ReadOnly"
                   value="@Value"
                   @oninput="HandleInput"
                   @onfocus="HandleFocus"
                   @onblur="HandleBlur"
                   @attributes="AdditionalAttributes" />
        }

        @if (!string.IsNullOrEmpty(IconEnd))
        {
            <span class="ac-input-icon ac-input-icon-end">
                <i class="@IconEnd"></i>
            </span>
        }
    </div>

    @if (!string.IsNullOrEmpty(ErrorMessage) && HasError)
    {
        <span class="ac-error-message">@ErrorMessage</span>
    }
    else if (!string.IsNullOrEmpty(HelpText))
    {
        <span class="ac-help-text">@HelpText</span>
    }
</div>

@code {
    [Parameter] public string? Id { get; set; }
    [Parameter] public string? Label { get; set; }
    [Parameter] public string Type { get; set; } = "text";
    [Parameter] public string? Placeholder { get; set; }
    [Parameter] public string? Value { get; set; }
    [Parameter] public EventCallback<string> ValueChanged { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public bool ReadOnly { get; set; }
    [Parameter] public bool Required { get; set; }
    [Parameter] public bool HasError { get; set; }
    [Parameter] public string? ErrorMessage { get; set; }
    [Parameter] public string? HelpText { get; set; }
    [Parameter] public string? IconStart { get; set; }
    [Parameter] public string? IconEnd { get; set; }
    [Parameter] public InputSize Size { get; set; } = InputSize.Medium;
    [Parameter] public int Rows { get; set; } = 3;
    [Parameter] public string? Class { get; set; }
    [Parameter] public EventCallback OnFocus { get; set; }
    [Parameter] public EventCallback OnBlur { get; set; }
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private string InputSizeClass => Size switch
    {
        InputSize.Small => "ac-input-sm",
        InputSize.Large => "ac-input-lg",
        _ => ""
    };

    private async Task HandleInput(ChangeEventArgs e)
    {
        Value = e.Value?.ToString();
        await ValueChanged.InvokeAsync(Value);
    }

    private async Task HandleFocus()
    {
        await OnFocus.InvokeAsync();
    }

    private async Task HandleBlur()
    {
        await OnBlur.InvokeAsync();
    }
}
