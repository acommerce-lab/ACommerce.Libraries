using System.ComponentModel.DataAnnotations.Schema;
using ACommerce.Catalog.Currencies.Entities;
using ACommerce.SharedKernel.Abstractions.Entities;

namespace ACommerce.Catalog.Products.Entities;


/// <summary>
/// ??? ?????? (????? ?????? ??? ????? ???)
/// </summary>
public class ProductPrice : IBaseEntity
{
	public Guid Id { get; set; }
	public DateTime CreatedAt { get; set; }
	public DateTime? UpdatedAt { get; set; }
	public bool IsDeleted { get; set; }

	/// <summary>
	/// ???? ??????
	/// </summary>
	public Guid ProductId { get; set; }
	public Product? Product { get; set; }

	/// <summary>
	/// ???? ??????
	/// </summary>
	public Guid CurrencyId { get; set; }
	public Currency? Currency { get; set; }

	/// <summary>
	/// ????? ???????
	/// </summary>
	public decimal BasePrice { get; set; }

	/// <summary>
	/// ??? ????? (??? ?????)
	/// </summary>
	public decimal? SalePrice { get; set; }

	/// <summary>
	/// ???? ?????
	/// </summary>
	public decimal? DiscountPercentage { get; set; }

	/// <summary>
	/// ????? ????? ?????
	/// </summary>
	public DateTime? SaleStartDate { get; set; }

	/// <summary>
	/// ????? ????? ?????
	/// </summary>
	public DateTime? SaleEndDate { get; set; }

	/// <summary>
	/// ????? ?????? (BasePrice ?? SalePrice ??? ??????)
	/// </summary>
	public decimal EffectivePrice =>
		SalePrice.HasValue &&
		(!SaleStartDate.HasValue || SaleStartDate.Value <= DateTime.UtcNow) &&
		(!SaleEndDate.HasValue || SaleEndDate.Value >= DateTime.UtcNow)
			? SalePrice.Value
			: BasePrice;

	/// <summary>
	/// ?????/??????? (???????)
	/// ???: "SA", "US", "EU"
	/// </summary>
	public string? Market { get; set; }

	/// <summary>
	/// ????? ??????? (???????)
	/// ???: "retail", "wholesale", "vip"
	/// </summary>
	public string? CustomerSegment { get; set; }

	/// <summary>
	/// ???? ?????? ??????
	/// </summary>
	public int MinQuantity { get; set; } = 1;

	/// <summary>
	/// ???? ?????? ??????
	/// </summary>
	public int? MaxQuantity { get; set; }

	/// <summary>
	/// ?? ????? ????
	/// </summary>
	public bool IsActive { get; set; } = true;

	/// <summary>
	/// ??????? ??????
	/// </summary>
	[NotMapped]
	public Dictionary<string, string> Metadata { get; set; } = new();
}

